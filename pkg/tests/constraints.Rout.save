
R version 3.1.2 (2014-10-31) -- "Pumpkin Helmet"
Copyright (C) 2014 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ### Various tests for constrained optimization
> ###
> options(digits=4)
> 
> logLikMix <- function(param) {
+    rho <- param[1]
+    if(rho < 0 || rho > 1)
+        return(NA)
+    mu1 <- param[2]
+    mu2 <- param[3]
+    ll <- log(rho*dnorm(x - mu1) + (1 - rho)*dnorm(x - mu2))
+ #   ll <- sum(ll)
+    ll
+ }
> 
> gradLikMix <- function(param) {
+    rho <- param[1]
+    if(rho < 0 || rho > 1)
+        return(NA)
+    mu1 <- param[2]
+    mu2 <- param[3]
+    f1 <- dnorm(x - mu1)
+    f2 <- dnorm(x - mu2)
+    L <- rho*f1 + (1 - rho)*f2
+    g <- matrix(0, length(x), 3)
+    g[,1] <- (f1 - f2)/L
+    g[,2] <- rho*(x - mu1)*f1/L
+    g[,3] <- (1 - rho)*(x - mu2)*f2/L
+ #   colSums(g)
+    g
+ }
> 
> hessLikMix <- function(param) {
+    rho <- param[1]
+    if(rho < 0 || rho > 1)
+        return(NA)
+    mu1 <- param[2]
+    mu2 <- param[3]
+    f1 <- dnorm(x - mu1)
+    f2 <- dnorm(x - mu2)
+    L <- rho*f1 + (1 - rho)*f2
+    dldrho <- (f1 - f2)/L
+    dldmu1 <- rho*(x - mu1)*f1/L
+    dldmu2 <- (1 - rho)*(x - mu2)*f2/L
+    h <- matrix(0, 3, 3)
+    h[1,1] <- -sum(dldrho*(f1 - f2)/L)
+    h[2,1] <- h[1,2] <- sum((x - mu1)*f1/L - dldmu1*dldrho)
+    h[3,1] <- h[1,3] <- sum(-(x - mu2)*f2/L - dldmu2*dldrho)
+    h[2,2] <- sum(rho*(-f1 + (x - mu1)^2*f1)/L - dldmu1^2)
+    h[2,3] <- h[3,2] <- -sum(dldmu1*dldmu2)
+    h[3,3] <- sum((1 - rho)*(-f2 + (x - mu2)^2*f2)/L - dldmu2^2)
+    h
+ }
> ### --------------------------
> library(maxLik)
Loading required package: miscTools

Please cite the 'maxLik' package as:
Henningsen, Arne and Toomet, Ott (2011). maxLik: A package for maximum likelihood estimation in R. Computational Statistics 26(3), 443-458. DOI 10.1007/s00180-010-0217-1.

If you have questions, suggestions, or comments regarding the 'maxLik' package, please use a forum or 'tracker' at maxLik's R-Forge site:
https://r-forge.r-project.org/projects/maxlik/
> ## mixed normal
> set.seed(1)
> x <- c(rnorm(1000, mean=-1), rnorm(1000, mean=1))
> 
> cat("Test for inequality constraints\n")
Test for inequality constraints
> ## Inequality constraints: x + y + z < 0.5
> A <- matrix(c(-1, 0, 0,
+               0, -1, 0,
+               0, 0, 1), 3, 3, byrow=TRUE)
> B <- rep(0.5, 3)
> start <- c(0.4, 0, 0.9)
> ## analytic gradient
> a <- maxLik(logLikMix, grad=gradLikMix, hess=hessLikMix,
+             start=start,
+             constraints=list(ineqA=A, ineqB=B),
+             print.level=1)
initial  value 4001.919470 
iter   2 value 3924.195358
iter   3 value 3761.072283
iter   4 value 3740.857616
iter   5 value 3739.836172
iter   6 value 3739.669432
iter   7 value 3739.505309
iter   8 value 3739.342676
iter   9 value 3739.271657
iter  10 value 3674.195874
iter  11 value 3671.068664
iter  12 value 3626.168499
iter  13 value 3589.952102
iter  14 value 3552.974446
iter  15 value 3551.811868
iter  16 value 3551.806291
iter  17 value 3551.796762
iter  18 value 3551.796515
iter  19 value 3551.782574
iter  20 value 3551.776359
iter  21 value 3551.776203
iter  22 value 3551.775817
iter  23 value 3551.774828
iter  24 value 3551.773893
iter  25 value 3551.773735
iter  26 value 3551.773660
iter  27 value 3551.773589
iter  27 value 3551.773574
iter  27 value 3551.773567
final  value 3551.773567 
converged
> print( summary( a ), digits = 2 )
--------------------------------------------
Maximum Likelihood estimation
BFGS maximisation, 135 iterations
Return code 0: successful convergence 
Log-Likelihood: -3552 
3  free parameters
Estimates:
     Estimate Std. error t value Pr(> t)    
[1,]    0.500      0.026      20  <2e-16 ***
[2,]   -1.036      0.058     -18  <2e-16 ***
[3,]    1.011      0.058      17  <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Warning: constrained likelihood estimation. Inference is probably wrong
Constrained optimization based on constrOptim 
1  outer iterations, barrier value -0.0002019 
--------------------------------------------
> ## No analytic gradient
> a <- maxLik(logLikMix, 
+             start=start,
+             constraints=list(ineqA=A, ineqB=B),
+             print.level=1)
  Nelder-Mead direct search function minimizer
function value for initial parameters = 4001.919470
  Scaled convergence tolerance is 4.00192e-05
Stepsize computed as 0.090000
BUILD              4 4070.076564 3935.045316
EXTENSION          6 4019.701151 3817.775378
HI-REDUCTION       8 4001.919470 3817.775378
HI-REDUCTION      10 3964.166942 3817.775378
HI-REDUCTION      12 3951.510291 3817.775378
HI-REDUCTION      14 3935.045316 3817.775378
LO-REDUCTION      16 3930.566819 3817.775378
EXTENSION         18 3921.548166 3738.446677
REFLECTION        20 3849.017731 3697.331824
HI-REDUCTION      22 3817.775378 3697.331824
EXTENSION         24 3796.154073 3640.588562
REFLECTION        26 3738.446677 3610.867576
REFLECTION        28 3697.331824 3599.961403
LO-REDUCTION      30 3640.588562 3598.894864
REFLECTION        32 3610.867576 3582.230855
LO-REDUCTION      34 3599.961403 3582.230855
LO-REDUCTION      36 3598.894864 3582.230855
LO-REDUCTION      38 3596.438166 3582.230855
HI-REDUCTION      40 3591.172140 3582.230855
REFLECTION        42 3589.835538 3581.931156
HI-REDUCTION      44 3588.467471 3581.931156
EXTENSION         46 3586.686697 3580.648495
HI-REDUCTION      48 3583.294588 3580.648495
HI-REDUCTION      50 3582.230855 3580.648495
EXTENSION         52 3581.931156 3577.586010
HI-REDUCTION      54 3581.845218 3577.586010
HI-REDUCTION      56 3580.648495 3577.586010
LO-REDUCTION      58 3580.218134 3577.586010
REFLECTION        60 3580.058076 3577.484332
HI-REDUCTION      62 3579.426189 3577.484332
HI-REDUCTION      64 3578.982021 3577.484332
HI-REDUCTION      66 3578.579385 3577.484332
HI-REDUCTION      68 3578.345785 3577.484332
REFLECTION        70 3578.107164 3576.925164
HI-REDUCTION      72 3577.646064 3576.925164
HI-REDUCTION      74 3577.586010 3576.925164
LO-REDUCTION      76 3577.484332 3576.925164
LO-REDUCTION      78 3577.429210 3576.925164
HI-REDUCTION      80 3577.265184 3576.925164
LO-REDUCTION      82 3577.219661 3576.925164
HI-REDUCTION      84 3577.099850 3576.925164
HI-REDUCTION      86 3577.094624 3576.925164
LO-REDUCTION      88 3577.049724 3576.925164
REFLECTION        90 3577.022908 3576.878815
HI-REDUCTION      92 3576.964251 3576.878815
HI-REDUCTION      94 3576.959035 3576.878815
HI-REDUCTION      96 3576.939769 3576.878815
LO-REDUCTION      98 3576.934288 3576.878815
HI-REDUCTION     100 3576.925164 3576.878815
REFLECTION       102 3576.914513 3576.868808
HI-REDUCTION     104 3576.895326 3576.868808
HI-REDUCTION     106 3576.885892 3576.868808
HI-REDUCTION     108 3576.884756 3576.868808
EXTENSION        110 3576.881216 3576.860066
EXTENSION        112 3576.878815 3576.846035
LO-REDUCTION     114 3576.868808 3576.846035
EXTENSION        116 3576.860066 3576.826644
LO-REDUCTION     118 3576.850118 3576.826644
EXTENSION        120 3576.846035 3576.795453
LO-REDUCTION     122 3576.830785 3576.795453
EXTENSION        124 3576.826644 3576.770783
EXTENSION        126 3576.813143 3576.731194
EXTENSION        128 3576.795453 3576.670398
EXTENSION        130 3576.770783 3576.579253
EXTENSION        132 3576.731194 3576.442993
EXTENSION        134 3576.670398 3576.223487
EXTENSION        136 3576.579253 3575.955768
EXTENSION        138 3576.442993 3575.458196
EXTENSION        140 3576.223487 3574.737591
EXTENSION        142 3575.955768 3574.113778
EXTENSION        144 3575.458196 3572.467004
EXTENSION        146 3574.737591 3571.094833
LO-REDUCTION     148 3574.113778 3571.094833
EXTENSION        150 3572.467004 3567.948694
LO-REDUCTION     152 3571.223239 3567.948694
EXTENSION        154 3571.094833 3566.372585
LO-REDUCTION     156 3569.258295 3566.372585
EXTENSION        158 3567.948694 3563.385318
LO-REDUCTION     160 3567.462533 3563.385318
EXTENSION        162 3566.372585 3560.575633
LO-REDUCTION     164 3565.263780 3560.575633
EXTENSION        166 3563.385318 3555.903915
LO-REDUCTION     168 3560.581821 3555.903915
EXTENSION        170 3560.575633 3553.680856
LO-REDUCTION     172 3555.956041 3553.680856
LO-REDUCTION     174 3555.903915 3553.680856
LO-REDUCTION     176 3553.731773 3553.520094
HI-REDUCTION     178 3553.718627 3553.520094
REFLECTION       180 3553.680856 3553.510276
HI-REDUCTION     182 3553.573127 3553.510276
HI-REDUCTION     184 3553.529694 3553.501609
HI-REDUCTION     186 3553.520094 3553.490628
HI-REDUCTION     188 3553.510276 3553.490074
HI-REDUCTION     190 3553.501609 3553.489874
HI-REDUCTION     192 3553.490628 3553.488166
HI-REDUCTION     194 3553.490074 3553.485596
HI-REDUCTION     196 3553.489874 3553.485526
LO-REDUCTION     198 3553.488166 3553.485526
LO-REDUCTION     200 3553.486044 3553.484862
HI-REDUCTION     202 3553.485596 3553.484790
HI-REDUCTION     204 3553.485526 3553.484790
HI-REDUCTION     206 3553.484862 3553.484686
HI-REDUCTION     208 3553.484809 3553.484638
EXTENSION        210 3553.484790 3553.484345
HI-REDUCTION     212 3553.484686 3553.484345
LO-REDUCTION     214 3553.484638 3553.484345
EXTENSION        216 3553.484449 3553.483714
LO-REDUCTION     218 3553.484392 3553.483714
LO-REDUCTION     220 3553.484345 3553.483714
EXTENSION        222 3553.484052 3553.482870
EXTENSION        224 3553.483862 3553.482183
LO-REDUCTION     226 3553.483714 3553.482183
EXTENSION        228 3553.482870 3553.479861
LO-REDUCTION     230 3553.482285 3553.479861
EXTENSION        232 3553.482183 3553.477861
EXTENSION        234 3553.479938 3553.473345
LO-REDUCTION     236 3553.479861 3553.473345
EXTENSION        238 3553.477861 3553.467046
EXTENSION        240 3553.474385 3553.460532
EXTENSION        242 3553.473345 3553.452464
EXTENSION        244 3553.467046 3553.445373
EXTENSION        246 3553.460532 3553.439398
REFLECTION       248 3553.452464 3553.437243
HI-REDUCTION     250 3553.445373 3553.437243
REFLECTION       252 3553.442210 3553.436552
HI-REDUCTION     254 3553.439398 3553.436552
EXTENSION        256 3553.437748 3553.430185
LO-REDUCTION     258 3553.437243 3553.430185
LO-REDUCTION     260 3553.436552 3553.430185
EXTENSION        262 3553.433970 3553.423188
EXTENSION        264 3553.430361 3553.414657
LO-REDUCTION     266 3553.430185 3553.414657
EXTENSION        268 3553.423188 3553.400875
LO-REDUCTION     270 3553.420802 3553.400875
EXTENSION        272 3553.414657 3553.373760
LO-REDUCTION     274 3553.401760 3553.373760
EXTENSION        276 3553.400875 3553.350247
EXTENSION        278 3553.375225 3553.304267
EXTENSION        280 3553.373760 3553.268822
EXTENSION        282 3553.350247 3553.229079
EXTENSION        284 3553.304267 3553.137320
EXTENSION        286 3553.268822 3553.072409
LO-REDUCTION     288 3553.229079 3553.072409
REFLECTION       290 3553.137320 3553.047964
LO-REDUCTION     292 3553.131070 3553.047964
EXTENSION        294 3553.077571 3552.946477
LO-REDUCTION     296 3553.072409 3552.946477
REFLECTION       298 3553.047964 3552.945615
EXTENSION        300 3552.952602 3552.765711
LO-REDUCTION     302 3552.946477 3552.765711
LO-REDUCTION     304 3552.945615 3552.765711
EXTENSION        306 3552.873655 3552.652256
EXTENSION        308 3552.820500 3552.547562
EXTENSION        310 3552.765711 3552.363444
LO-REDUCTION     312 3552.652256 3552.363444
REFLECTION       314 3552.547562 3552.342542
REFLECTION       316 3552.488021 3552.334013
REFLECTION       318 3552.363444 3552.210067
HI-REDUCTION     320 3552.342542 3552.210067
LO-REDUCTION     322 3552.334013 3552.210067
EXTENSION        324 3552.310291 3552.151579
HI-REDUCTION     326 3552.253251 3552.151579
LO-REDUCTION     328 3552.243475 3552.151579
EXTENSION        330 3552.210067 3552.038246
LO-REDUCTION     332 3552.164428 3552.038246
LO-REDUCTION     334 3552.151579 3552.038246
EXTENSION        336 3552.108582 3552.000997
EXTENSION        338 3552.065680 3551.917912
EXTENSION        340 3552.038246 3551.884966
HI-REDUCTION     342 3552.000997 3551.884966
REFLECTION       344 3551.942773 3551.819101
LO-REDUCTION     346 3551.917912 3551.819101
LO-REDUCTION     348 3551.884966 3551.819101
REFLECTION       350 3551.854207 3551.806548
REFLECTION       352 3551.838194 3551.785401
HI-REDUCTION     354 3551.819101 3551.785401
LO-REDUCTION     356 3551.811870 3551.785401
HI-REDUCTION     358 3551.806548 3551.785401
LO-REDUCTION     360 3551.799075 3551.785401
HI-REDUCTION     362 3551.791224 3551.785401
REFLECTION       364 3551.788895 3551.778850
LO-REDUCTION     366 3551.785680 3551.778850
LO-REDUCTION     368 3551.785401 3551.778850
EXTENSION        370 3551.783330 3551.775262
HI-REDUCTION     372 3551.780951 3551.775262
LO-REDUCTION     374 3551.779833 3551.775262
HI-REDUCTION     376 3551.778850 3551.775262
LO-REDUCTION     378 3551.777855 3551.775262
HI-REDUCTION     380 3551.777322 3551.775262
EXTENSION        382 3551.776790 3551.774636
HI-REDUCTION     384 3551.776184 3551.774636
REFLECTION       386 3551.775872 3551.774140
HI-REDUCTION     388 3551.775262 3551.774140
LO-REDUCTION     390 3551.775146 3551.774140
LO-REDUCTION     392 3551.774636 3551.774140
EXTENSION        394 3551.774549 3551.773588
HI-REDUCTION     396 3551.774180 3551.773588
HI-REDUCTION     398 3551.774167 3551.773588
HI-REDUCTION     400 3551.774140 3551.773588
LO-REDUCTION     402 3551.774001 3551.773588
REFLECTION       404 3551.773936 3551.773536
HI-REDUCTION     406 3551.773772 3551.773536
HI-REDUCTION     408 3551.773745 3551.773536
HI-REDUCTION     410 3551.773672 3551.773536
HI-REDUCTION     412 3551.773648 3551.773536
HI-REDUCTION     414 3551.773612 3551.773536
HI-REDUCTION     416 3551.773595 3551.773536
HI-REDUCTION     418 3551.773588 3551.773536
Exiting from Nelder Mead minimizer
    420 function evaluations used
> print( summary( a ), digits = 2 )
--------------------------------------------
Maximum Likelihood estimation
Nelder-Mead maximisation, 420 iterations
Return code 0: successful convergence 
Log-Likelihood: -3552 
3  free parameters
Estimates:
     Estimate Std. error t value Pr(> t)    
[1,]    0.500      0.026      20  <2e-16 ***
[2,]   -1.036      0.058     -18  <2e-16 ***
[3,]    1.011      0.058      17  <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Warning: constrained likelihood estimation. Inference is probably wrong
Constrained optimization based on constrOptim 
1  outer iterations, barrier value -0.0002034 
--------------------------------------------
> ## No analytic gradient, BFGS
> a <- maxLik(logLikMix, 
+             start=start,
+             method="bfgs",
+             constraints=list(ineqA=A, ineqB=B),
+             print.level=1)
initial  value 4001.919470 
iter   2 value 3924.195358
iter   3 value 3761.072284
iter   4 value 3740.857617
iter   5 value 3739.836172
iter   6 value 3739.669432
iter   7 value 3739.505310
iter   8 value 3739.342677
iter   9 value 3739.271657
iter  10 value 3674.195801
iter  11 value 3671.068581
iter  12 value 3626.166671
iter  13 value 3589.951141
iter  14 value 3552.974393
iter  15 value 3551.811864
iter  16 value 3551.806287
iter  17 value 3551.796760
iter  18 value 3551.796512
iter  19 value 3551.782572
iter  20 value 3551.776358
iter  21 value 3551.776202
iter  22 value 3551.775817
iter  23 value 3551.774783
iter  24 value 3551.773837
iter  25 value 3551.773689
iter  26 value 3551.773624
iter  27 value 3551.773583
iter  27 value 3551.773572
iter  27 value 3551.773564
final  value 3551.773564 
converged
> print( summary( a ), digits = 2 )
--------------------------------------------
Maximum Likelihood estimation
BFGS maximisation, 135 iterations
Return code 0: successful convergence 
Log-Likelihood: -3552 
3  free parameters
Estimates:
     Estimate Std. error t value Pr(> t)    
[1,]    0.500      0.026      20  <2e-16 ***
[2,]   -1.036      0.058     -18  <2e-16 ***
[3,]    1.011      0.058      17  <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Warning: constrained likelihood estimation. Inference is probably wrong
Constrained optimization based on constrOptim 
1  outer iterations, barrier value -0.0001999 
--------------------------------------------
> ## ----
> cat("Test for equality constraints\n")
Test for equality constraints
> A <- matrix(c(0, 1, 2), 1, 3)
> B <- 0
> ## default, analytic gradient
> a <- maxLik(logLikMix, grad=gradLikMix, hess=hessLikMix,
+             start=start,
+             constraints=list(eqA=A, eqB=B),
+             print.level=1)
SUMT initial: rho =  0 , function =  -3552 , penalty =  1.004 
Estimate:[1]  0.5033 -1.0307  1.0163
SUMT iteration 1: rho = 0.0003086, function = -3552, penalty = 1.004
Estimate:[1]  0.5033 -1.0307  1.0163
SUMT iteration 2: rho = 0.003086, function = -3552, penalty = 1.003
Estimate:[1]  0.5033 -1.0307  1.0162
SUMT iteration 3: rho = 0.03086, function = -3552, penalty = 1.001
Estimate:[1]  0.5031 -1.0311  1.0157
SUMT iteration 4: rho = 0.3086, function = -3552, penalty = 0.9731
Estimate:[1]  0.5013 -1.0352  1.0109
SUMT iteration 5: rho = 3.086, function = -3552, penalty = 0.7532
Estimate:[1]  0.4859 -1.0710  0.9694
SUMT iteration 6: rho = 30.86, function = -3559, penalty = 0.1604
Estimate:[1]  0.4241 -1.2225  0.8115
SUMT iteration 7: rho = 308.6, function = -3570, penalty = 0.003967
Estimate:[1]  0.3789 -1.3439  0.7034
SUMT iteration 8: rho = 3086, function = -3572, penalty = 4.458e-05
Estimate:[1]  0.3714 -1.3652  0.6859
SUMT iteration 9: rho = 30864, function = -3572, penalty = 4.512e-07
Estimate:[1]  0.3706 -1.3675  0.6841
SUMT iteration 10: rho = 308642, function = -3572, penalty = 4.517e-09
Estimate:[1]  0.3705 -1.3677  0.6839
> print( summary( a ), digits = 2 )
--------------------------------------------
Maximum Likelihood estimation
Newton-Raphson maximisation, 2 iterations
Return code 1: gradient close to zero
Log-Likelihood: -3572 
3  free parameters
Estimates:
     Estimate Std. error t value Pr(> t)    
[1,]    0.370      0.025      14  <2e-16 ***
[2,]   -1.368      0.070     -20  <2e-16 ***
[3,]    0.684      0.051      13  <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Warning: constrained likelihood estimation. Inference is probably wrong
Constrained optimization based on SUMT 
Return code: 1 
penalty close to zero 
10  outer iterations, barrier value 4.517e-09 
--------------------------------------------
> ## BFGS, numeric gradient
> a <- maxLik(logLikMix, 
+             start=start, method="bfgs",
+             constraints=list(eqA=A, eqB=B),
+             print.level=2, SUMTRho0=1)
initial  value 4005.159409 
iter   2 value 3739.377952
iter   3 value 3557.996031
iter   4 value 3557.243792
iter   5 value 3553.534181
iter   6 value 3552.770637
iter   7 value 3552.720577
iter   8 value 3552.720532
iter   8 value 3552.720532
final  value 3552.720532 
converged
SUMT iteration 1: rho = 1, function = -3552, penalty = 0.9097
Estimate:[1]  0.4971 -1.0450  0.9994
initial  value 3560.907808 
iter   2 value 3559.815796
iter   3 value 3558.860634
iter   4 value 3558.554874
iter   5 value 3558.470121
iter   5 value 3558.470095
iter   5 value 3558.470095
final  value 3558.470095 
converged
SUMT iteration 2: rho = 10, function = -3554, penalty = 0.4502
Estimate:[1]  0.4600 -1.1326  0.9018
initial  value 3598.986588 
iter   2 value 3581.662692
iter   3 value 3575.592026
iter   4 value 3574.296760
iter   5 value 3568.837187
iter   6 value 3568.828225
iter   6 value 3568.828218
iter   6 value 3568.828218
final  value 3568.828218 
converged
SUMT iteration 3: rho = 100, function = -3566, penalty = 0.02948
Estimate:[1]  0.3934 -1.3036  0.7376
initial  value 3595.363566 
iter   2 value 3575.235881
iter   3 value 3574.538052
iter   4 value 3574.332600
iter   5 value 3571.971345
iter   6 value 3571.969966
iter   6 value 3571.969966
iter   6 value 3571.969966
final  value 3571.969966 
converged
SUMT iteration 4: rho = 1000, function = -3572, penalty = 0.0004131
Estimate:[1]  0.3732 -1.3600  0.6902
initial  value 3575.687741 
iter   2 value 3572.641972
iter   3 value 3572.631516
iter   4 value 3572.627232
iter   5 value 3572.353862
iter   6 value 3572.348648
iter   6 value 3572.348648
iter   6 value 3572.348648
final  value 3572.348648 
converged
SUMT iteration 5: rho = 10000, function = -3572, penalty = 4.286e-06
Estimate:[1]  0.3707 -1.3670  0.6845
initial  value 3572.734360 
iter   2 value 3572.469952
iter   3 value 3572.469793
iter   4 value 3572.469005
iter   5 value 3572.387435
iter   6 value 3572.387291
iter   6 value 3572.387291
iter   6 value 3572.387291
final  value 3572.387291 
converged
SUMT iteration 6: rho = 1e+05, function = -3572, penalty = 4.302e-08
Estimate:[1]  0.3705 -1.3677  0.6839
initial  value 3572.426005 
iter   2 value 3572.391185
iter   2 value 3572.391184
iter   2 value 3572.391164
final  value 3572.391164 
converged
SUMT iteration 7: rho = 1e+06, function = -3572, penalty = 4.348e-10
Estimate:[1]  0.3705 -1.3677  0.6839
> print( summary( a ), digits = 2 )
--------------------------------------------
Maximum Likelihood estimation
BFGS maximisation, 29 iterations
Return code 0: successful convergence 
Log-Likelihood: -3572 
3  free parameters
Estimates:
     Estimate Std. error t value Pr(> t)    
[1,]    0.370      0.025      14  <2e-16 ***
[2,]   -1.368      0.070     -20  <2e-16 ***
[3,]    0.684      0.051      13  <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Warning: constrained likelihood estimation. Inference is probably wrong
Constrained optimization based on SUMT 
Return code: 1 
penalty close to zero 
7  outer iterations, barrier value 4.348e-10 
--------------------------------------------
> ## BHHH, analytic gradient (numeric does not converge?)
> try( maxLik(logLikMix, gradLikMix,
+             start=start, method="bhhh",
+             constraints=list(eqA=A, eqB=B),
+             print.level=2, SUMTRho0=1) )
--------------
successive function values within tolerance limit 
18  iterations
estimate: 0.4902 1.031 -1.013 
Function value: -3553 
SUMT iteration 1: rho = 1, function = -3552, penalty = 0.9906
Estimate:[1]  0.4902  1.0313 -1.0133
--------------
successive function values within tolerance limit 
10  iterations
estimate: 0.4516 1.124 -0.9126 
Function value: -3559 
SUMT iteration 2: rho = 10, function = -3554, penalty = 0.4917
Estimate:[1]  0.4516  1.1240 -0.9126
--------------
successive function values within tolerance limit 
18  iterations
estimate: 0.3819 1.307 -0.743 
Function value: -3570 
SUMT iteration 3: rho = 100, function = -3567, penalty = 0.03214
Estimate:[1]  0.3819  1.3068 -0.7430
--------------
successive function values within tolerance limit 
88  iterations
estimate: 0.3608 1.367 -0.6943 
Function value: -3574 
SUMT iteration 4: rho = 1000, function = -3573, penalty = 0.0004494
Estimate:[1]  0.3608  1.3674 -0.6943
--------------
Iteration limit exceeded. 
100  iterations
estimate: 0.3583 1.376 -0.6889 
Function value: -3574 
SUMT iteration 5: rho = 10000, function = -3574, penalty = 4.694e-06
Estimate:[1]  0.3583  1.3756 -0.6889
--------------
Iteration limit exceeded. 
100  iterations
estimate: 0.358 1.376 -0.6883 
Function value: -3574 
SUMT iteration 6: rho = 1e+05, function = -3574, penalty = 8.22e-08
Estimate:[1]  0.3580  1.3764 -0.6883
--------------
successive function values within tolerance limit 
65  iterations
estimate: 0.358 1.377 -0.6883 
Function value: -3574 
SUMT iteration 7: rho = 1e+06, function = -3574, penalty = 4.576e-10
Estimate:[1]  0.3580  1.3765 -0.6883
Maximum Likelihood estimation
BHHH maximisation, 65 iterations
Return code 2: successive function values within tolerance limit
Log-Likelihood: -3574 (3 free parameter(s))
Estimate(s): 0.358 1.377 -0.6883 
> 
> ### ------------------ Now test extra parameters for the function ----
> logLikMix2 <- function(param, rho) {
+    mu1 <- param[1]
+    mu2 <- param[2]
+    ll <- log(rho*dnorm(x - mu1) + (1 - rho)*dnorm(x - mu2))
+ #   ll <- sum(ll)
+    ll
+ }
> 
> gradLikMix2 <- function(param, rho) {
+    mu1 <- param[1]
+    mu2 <- param[2]
+    f1 <- dnorm(x - mu1)
+    f2 <- dnorm(x - mu2)
+    L <- rho*f1 + (1 - rho)*f2
+    g <- matrix(0, length(x), 2)
+    g[,1] <- rho*(x - mu1)*f1/L
+    g[,2] <- (1 - rho)*(x - mu2)*f2/L
+ #   colSums(g)
+    g
+ }
> 
> hessLikMix2 <- function(param, rho) {
+    mu1 <- param[1]
+    mu2 <- param[2]
+    f1 <- dnorm(x - mu1)
+    f2 <- dnorm(x - mu2)
+    L <- rho*f1 + (1 - rho)*f2
+    dldrho <- (f1 - f2)/L
+    dldmu1 <- rho*(x - mu1)*f1/L
+    dldmu2 <- (1 - rho)*(x - mu2)*f2/L
+    h <- matrix(0, 2, 2)
+    h[1,1] <- sum(rho*(-f1 + (x - mu1)^2*f1)/L - dldmu1^2)
+    h[1,2] <- h[2,1] <- -sum(dldmu1*dldmu2)
+    h[2,2] <- sum((1 - rho)*(-f2 + (x - mu2)^2*f2)/L - dldmu2^2)
+    h
+ }
> 
> ## ----------
> A <- matrix(c(1, 2), 1, 2)
> B <- 0
> start <- c(0, 1)
> ## nr, numeric gradient
> a <- maxLik(logLikMix2,
+             start=start, method="nr",
+             constraints=list(eqA=A, eqB=B),
+             print.level=1, SUMTRho0=1, rho=0.5)
SUMT iteration 1: rho = 1, function = -3552, penalty = 0.9371
Estimate:[1] -1.040  1.004
SUMT iteration 2: rho = 10, function = -3553, penalty = 0.7005
Estimate:[1] -1.0715  0.9542
SUMT iteration 3: rho = 100, function = -3574, penalty = 0.1327
Estimate:[1] -1.1949  0.7796
SUMT iteration 4: rho = 1000, function = -3602, penalty = 0.003096
Estimate:[1] -1.2860  0.6708
SUMT iteration 5: rho = 10000, function = -3608, penalty = 3.455e-05
Estimate:[1] -1.3015  0.6537
SUMT iteration 6: rho = 1e+05, function = -3609, penalty = 3.494e-07
Estimate:[1] -1.3032  0.6519
SUMT iteration 7: rho = 1e+06, function = -3609, penalty = 3.498e-09
Estimate:[1] -1.3034  0.6517
> print( summary( a ), digits = 2 )
--------------------------------------------
Maximum Likelihood estimation
Newton-Raphson maximisation, 2 iterations
Return code 1: gradient close to zero
Log-Likelihood: -3609 
2  free parameters
Estimates:
     Estimate Std. error t value Pr(> t)    
[1,]   -1.303      0.046     -28  <2e-16 ***
[2,]    0.652      0.035      18  <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Warning: constrained likelihood estimation. Inference is probably wrong
Constrained optimization based on SUMT 
Return code: 1 
penalty close to zero 
7  outer iterations, barrier value 3.498e-09 
--------------------------------------------
> ## nr, numeric hessian
> a <- maxLik(logLikMix2, gradLikMix2, 
+             start=start, method="nr",
+             constraints=list(eqA=A, eqB=B),
+             print.level=1, SUMTRho0=1, rho=0.5)
SUMT iteration 1: rho = 1, function = -3552, penalty = 0.9371
Estimate:[1] -1.040  1.004
SUMT iteration 2: rho = 10, function = -3553, penalty = 0.7005
Estimate:[1] -1.0715  0.9542
SUMT iteration 3: rho = 100, function = -3574, penalty = 0.1327
Estimate:[1] -1.1949  0.7796
SUMT iteration 4: rho = 1000, function = -3602, penalty = 0.003096
Estimate:[1] -1.2860  0.6708
SUMT iteration 5: rho = 10000, function = -3608, penalty = 3.455e-05
Estimate:[1] -1.3015  0.6537
SUMT iteration 6: rho = 1e+05, function = -3609, penalty = 3.494e-07
Estimate:[1] -1.3032  0.6519
SUMT iteration 7: rho = 1e+06, function = -3609, penalty = 3.498e-09
Estimate:[1] -1.3034  0.6517
> print( summary( a ), digits = 2 )
--------------------------------------------
Maximum Likelihood estimation
Newton-Raphson maximisation, 2 iterations
Return code 1: gradient close to zero
Log-Likelihood: -3609 
2  free parameters
Estimates:
     Estimate Std. error t value Pr(> t)    
[1,]   -1.303      0.046     -28  <2e-16 ***
[2,]    0.652      0.035      18  <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Warning: constrained likelihood estimation. Inference is probably wrong
Constrained optimization based on SUMT 
Return code: 1 
penalty close to zero 
7  outer iterations, barrier value 3.498e-09 
--------------------------------------------
> ## nr, analytic hessian
> a <- maxLik(logLikMix2, gradLikMix2, hessLikMix2,
+             start=start, method="nr",
+             constraints=list(eqA=A, eqB=B),
+             print.level=1, SUMTRho0=1, rho=0.5)
SUMT iteration 1: rho = 1, function = -3552, penalty = 0.9371
Estimate:[1] -1.040  1.004
SUMT iteration 2: rho = 10, function = -3553, penalty = 0.7005
Estimate:[1] -1.0715  0.9542
SUMT iteration 3: rho = 100, function = -3574, penalty = 0.1327
Estimate:[1] -1.1949  0.7796
SUMT iteration 4: rho = 1000, function = -3602, penalty = 0.003096
Estimate:[1] -1.2860  0.6708
SUMT iteration 5: rho = 10000, function = -3608, penalty = 3.455e-05
Estimate:[1] -1.3015  0.6537
SUMT iteration 6: rho = 1e+05, function = -3609, penalty = 3.494e-07
Estimate:[1] -1.3032  0.6519
SUMT iteration 7: rho = 1e+06, function = -3609, penalty = 3.498e-09
Estimate:[1] -1.3034  0.6517
> print( summary( a ), digits = 2 )
--------------------------------------------
Maximum Likelihood estimation
Newton-Raphson maximisation, 2 iterations
Return code 1: gradient close to zero
Log-Likelihood: -3609 
2  free parameters
Estimates:
     Estimate Std. error t value Pr(> t)    
[1,]   -1.303      0.046     -28  <2e-16 ***
[2,]    0.652      0.035      18  <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Warning: constrained likelihood estimation. Inference is probably wrong
Constrained optimization based on SUMT 
Return code: 1 
penalty close to zero 
7  outer iterations, barrier value 3.498e-09 
--------------------------------------------
> ## BHHH
> a <- maxLik(logLikMix2, gradLikMix2, 
+             start=start, method="bhhh",
+             constraints=list(eqA=A, eqB=B),
+             print.level=1, SUMTRho0=1, rho=0.5)
SUMT iteration 1: rho = 1, function = -3552, penalty = 0.9371
Estimate:[1] -1.040  1.004
SUMT iteration 2: rho = 10, function = -3553, penalty = 0.7005
Estimate:[1] -1.0715  0.9542
SUMT iteration 3: rho = 100, function = -3574, penalty = 0.1327
Estimate:[1] -1.1949  0.7796
SUMT iteration 4: rho = 1000, function = -3602, penalty = 0.003096
Estimate:[1] -1.2860  0.6708
SUMT iteration 5: rho = 10000, function = -3608, penalty = 3.456e-05
Estimate:[1] -1.3016  0.6537
SUMT iteration 6: rho = 1e+05, function = -3609, penalty = 3.48e-07
Estimate:[1] -1.303  0.652
SUMT iteration 7: rho = 1e+06, function = -3609, penalty = 3.515e-09
Estimate:[1] -1.3037  0.6519
> print( summary( a ), digits = 2 )
--------------------------------------------
Maximum Likelihood estimation
BHHH maximisation, 22 iterations
Return code 2: successive function values within tolerance limit
Log-Likelihood: -3609 
2  free parameters
Estimates:
     Estimate Std. error t value Pr(> t)    
[1,]   -1.304      0.046     -28  <2e-16 ***
[2,]    0.652      0.035      18  <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Warning: constrained likelihood estimation. Inference is probably wrong
Constrained optimization based on SUMT 
Return code: 1 
penalty close to zero 
7  outer iterations, barrier value 3.515e-09 
--------------------------------------------
> ## BHHH, analytic
> a <- maxLik(logLikMix2, gradLikMix2, 
+             start=start, method="bhhh",
+             constraints=list(eqA=A, eqB=B),
+             print.level=1, SUMTRho0=1, rho=0.5)
SUMT iteration 1: rho = 1, function = -3552, penalty = 0.9371
Estimate:[1] -1.040  1.004
SUMT iteration 2: rho = 10, function = -3553, penalty = 0.7005
Estimate:[1] -1.0715  0.9542
SUMT iteration 3: rho = 100, function = -3574, penalty = 0.1327
Estimate:[1] -1.1949  0.7796
SUMT iteration 4: rho = 1000, function = -3602, penalty = 0.003096
Estimate:[1] -1.2860  0.6708
SUMT iteration 5: rho = 10000, function = -3608, penalty = 3.456e-05
Estimate:[1] -1.3016  0.6537
SUMT iteration 6: rho = 1e+05, function = -3609, penalty = 3.48e-07
Estimate:[1] -1.303  0.652
SUMT iteration 7: rho = 1e+06, function = -3609, penalty = 3.515e-09
Estimate:[1] -1.3037  0.6519
> print( summary( a ), digits = 2 )
--------------------------------------------
Maximum Likelihood estimation
BHHH maximisation, 22 iterations
Return code 2: successive function values within tolerance limit
Log-Likelihood: -3609 
2  free parameters
Estimates:
     Estimate Std. error t value Pr(> t)    
[1,]   -1.304      0.046     -28  <2e-16 ***
[2,]    0.652      0.035      18  <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Warning: constrained likelihood estimation. Inference is probably wrong
Constrained optimization based on SUMT 
Return code: 1 
penalty close to zero 
7  outer iterations, barrier value 3.515e-09 
--------------------------------------------
> ## bfgs, no analytic gradient
> a <- maxLik(logLikMix2, 
+             start=start, method="bfgs",
+             constraints=list(eqA=A, eqB=B),
+             print.level=2, SUMTRho0=1, rho=0.5)
initial  value 3940.429579 
iter   2 value 3568.484771
iter   3 value 3565.703967
iter   4 value 3553.364145
iter   5 value 3552.730547
iter   6 value 3552.727255
iter   6 value 3552.727251
final  value 3552.727251 
converged
SUMT iteration 1: rho = 1, function = -3552, penalty = 0.9371
Estimate:[1] -1.040  1.004
initial  value 3561.161193 
iter   2 value 3560.033226
iter   3 value 3560.021863
iter   4 value 3560.015406
iter   4 value 3560.015405
iter   4 value 3560.015405
final  value 3560.015405 
converged
SUMT iteration 2: rho = 10, function = -3553, penalty = 0.7005
Estimate:[1] -1.0715  0.9542
initial  value 3623.062827 
iter   2 value 3595.991937
iter   3 value 3595.709044
iter   4 value 3587.340552
iter   5 value 3587.300893
iter   5 value 3587.300887
iter   5 value 3587.300887
final  value 3587.300887 
converged
SUMT iteration 3: rho = 100, function = -3574, penalty = 0.1327
Estimate:[1] -1.1949  0.7796
initial  value 3706.731799 
iter   2 value 3616.033745
iter   3 value 3615.699091
iter   4 value 3605.546681
iter   5 value 3605.514797
iter   5 value 3605.514797
iter   5 value 3605.514797
final  value 3605.514797 
converged
SUMT iteration 4: rho = 1000, function = -3602, penalty = 0.003096
Estimate:[1] -1.2860  0.6708
initial  value 3633.375248 
iter   2 value 3610.546094
iter   3 value 3610.527290
iter   4 value 3608.619657
iter   5 value 3608.458020
iter   5 value 3608.458020
iter   5 value 3608.458020
final  value 3608.458020 
converged
SUMT iteration 5: rho = 10000, function = -3608, penalty = 3.455e-05
Estimate:[1] -1.3015  0.6537
initial  value 3611.567445 
iter   2 value 3609.435906
iter   3 value 3609.427333
iter   4 value 3609.093787
iter   5 value 3608.770731
iter   5 value 3608.770731
iter   5 value 3608.770731
final  value 3608.770731 
converged
SUMT iteration 6: rho = 1e+05, function = -3609, penalty = 3.494e-07
Estimate:[1] -1.3032  0.6519
initial  value 3609.085218 
iter   2 value 3608.802363
iter   2 value 3608.802361
iter   3 value 3608.802198
iter   3 value 3608.802198
iter   3 value 3608.802197
final  value 3608.802197 
converged
SUMT iteration 7: rho = 1e+06, function = -3609, penalty = 3.497e-09
Estimate:[1] -1.3034  0.6517
> print( summary( a ), digits = 2 )
--------------------------------------------
Maximum Likelihood estimation
BFGS maximisation, 44 iterations
Return code 0: successful convergence 
Log-Likelihood: -3609 
2  free parameters
Estimates:
     Estimate Std. error t value Pr(> t)    
[1,]   -1.303      0.046     -28  <2e-16 ***
[2,]    0.652      0.035      18  <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Warning: constrained likelihood estimation. Inference is probably wrong
Constrained optimization based on SUMT 
Return code: 1 
penalty close to zero 
7  outer iterations, barrier value 3.497e-09 
--------------------------------------------
> ## bfgs, analytic gradient
> a <- maxLik(logLikMix2, 
+             start=start, method="bfgs",
+             constraints=list(eqA=A, eqB=B),
+             print.level=2, SUMTRho0=1, rho=0.5)
initial  value 3940.429579 
iter   2 value 3568.484771
iter   3 value 3565.703967
iter   4 value 3553.364145
iter   5 value 3552.730547
iter   6 value 3552.727255
iter   6 value 3552.727251
final  value 3552.727251 
converged
SUMT iteration 1: rho = 1, function = -3552, penalty = 0.9371
Estimate:[1] -1.040  1.004
initial  value 3561.161193 
iter   2 value 3560.033226
iter   3 value 3560.021863
iter   4 value 3560.015406
iter   4 value 3560.015405
iter   4 value 3560.015405
final  value 3560.015405 
converged
SUMT iteration 2: rho = 10, function = -3553, penalty = 0.7005
Estimate:[1] -1.0715  0.9542
initial  value 3623.062827 
iter   2 value 3595.991937
iter   3 value 3595.709044
iter   4 value 3587.340552
iter   5 value 3587.300893
iter   5 value 3587.300887
iter   5 value 3587.300887
final  value 3587.300887 
converged
SUMT iteration 3: rho = 100, function = -3574, penalty = 0.1327
Estimate:[1] -1.1949  0.7796
initial  value 3706.731799 
iter   2 value 3616.033745
iter   3 value 3615.699091
iter   4 value 3605.546681
iter   5 value 3605.514797
iter   5 value 3605.514797
iter   5 value 3605.514797
final  value 3605.514797 
converged
SUMT iteration 4: rho = 1000, function = -3602, penalty = 0.003096
Estimate:[1] -1.2860  0.6708
initial  value 3633.375248 
iter   2 value 3610.546094
iter   3 value 3610.527290
iter   4 value 3608.619657
iter   5 value 3608.458020
iter   5 value 3608.458020
iter   5 value 3608.458020
final  value 3608.458020 
converged
SUMT iteration 5: rho = 10000, function = -3608, penalty = 3.455e-05
Estimate:[1] -1.3015  0.6537
initial  value 3611.567445 
iter   2 value 3609.435906
iter   3 value 3609.427333
iter   4 value 3609.093787
iter   5 value 3608.770731
iter   5 value 3608.770731
iter   5 value 3608.770731
final  value 3608.770731 
converged
SUMT iteration 6: rho = 1e+05, function = -3609, penalty = 3.494e-07
Estimate:[1] -1.3032  0.6519
initial  value 3609.085218 
iter   2 value 3608.802363
iter   2 value 3608.802361
iter   3 value 3608.802198
iter   3 value 3608.802198
iter   3 value 3608.802197
final  value 3608.802197 
converged
SUMT iteration 7: rho = 1e+06, function = -3609, penalty = 3.497e-09
Estimate:[1] -1.3034  0.6517
> print( summary( a ), digits = 2 )
--------------------------------------------
Maximum Likelihood estimation
BFGS maximisation, 44 iterations
Return code 0: successful convergence 
Log-Likelihood: -3609 
2  free parameters
Estimates:
     Estimate Std. error t value Pr(> t)    
[1,]   -1.303      0.046     -28  <2e-16 ***
[2,]    0.652      0.035      18  <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Warning: constrained likelihood estimation. Inference is probably wrong
Constrained optimization based on SUMT 
Return code: 1 
penalty close to zero 
7  outer iterations, barrier value 3.497e-09 
--------------------------------------------
> ## SANN, analytic gradient
> a <- maxLik(logLikMix2, gradLikMix2,
+             start=start, method="SANN",
+             constraints=list(eqA=A, eqB=B),
+             print.level=1, SUMTRho0=1, rho=0.5)
SUMT iteration 1: rho = 1, function = -3552, penalty = 0.9372
Estimate:[1] -1.041  1.004
SUMT iteration 2: rho = 10, function = -3553, penalty = 0.7039
Estimate:[1] -1.0738  0.9564
SUMT iteration 3: rho = 100, function = -3574, penalty = 0.1346
Estimate:[1] -1.1943  0.7806
SUMT iteration 4: rho = 1000, function = -3602, penalty = 0.003156
Estimate:[1] -1.2906  0.6734
SUMT iteration 5: rho = 10000, function = -3608, penalty = 3.855e-05
Estimate:[1] -1.2995  0.6528
SUMT iteration 6: rho = 1e+05, function = -3609, penalty = 3.59e-07
Estimate:[1] -1.3023  0.6514
SUMT iteration 7: rho = 1e+06, function = -3609, penalty = 6.049e-09
Estimate:[1] -1.3121  0.6561
> print( summary( a ), digits = 2 )
--------------------------------------------
Maximum Likelihood estimation
SANN maximisation, 10000 iterations
Return code 0: successful convergence 
Log-Likelihood: -3609 
2  free parameters
Estimates:
     Estimate Std. error t value Pr(> t)    
[1,]   -1.312      0.046     -29  <2e-16 ***
[2,]    0.656      0.035      18  <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Warning: constrained likelihood estimation. Inference is probably wrong
Constrained optimization based on SUMT 
Return code: 1 
penalty close to zero 
7  outer iterations, barrier value 6.049e-09 
--------------------------------------------
> ## NM, numeric
> a <- maxLik(logLikMix2, 
+             start=start, method="nm",
+             constraints=list(eqA=A, eqB=B),
+             print.level=1, SUMTRho0=1, rho=0.5)
SUMT iteration 1: rho = 1, function = -3552, penalty = 0.9383
Estimate:[1] -1.040  1.004
SUMT iteration 2: rho = 10, function = -3553, penalty = 0.7009
Estimate:[1] -1.0715  0.9544
SUMT iteration 3: rho = 100, function = -3574, penalty = 0.1329
Estimate:[1] -1.1948  0.7797
SUMT iteration 4: rho = 1000, function = -3602, penalty = 0.003089
Estimate:[1] -1.2862  0.6709
SUMT iteration 5: rho = 10000, function = -3608, penalty = 3.433e-05
Estimate:[1] -1.3015  0.6537
SUMT iteration 6: rho = 1e+05, function = -3609, penalty = 3.391e-07
Estimate:[1] -1.3031  0.6519
SUMT iteration 7: rho = 1e+06, function = -3609, penalty = 3.755e-09
Estimate:[1] -1.3034  0.6517
> print( summary( a ), digits = 2 )
--------------------------------------------
Maximum Likelihood estimation
Nelder-Mead maximisation, 55 iterations
Return code 0: successful convergence 
Log-Likelihood: -3609 
2  free parameters
Estimates:
     Estimate Std. error t value Pr(> t)    
[1,]   -1.303      0.046     -28  <2e-16 ***
[2,]    0.652      0.035      18  <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Warning: constrained likelihood estimation. Inference is probably wrong
Constrained optimization based on SUMT 
Return code: 1 
penalty close to zero 
7  outer iterations, barrier value 3.755e-09 
--------------------------------------------
> f <- function(theta) exp(-theta %*% theta)
> ## NR, multiple constraints
> A <- matrix(c(1, 0, 1,
+               1, 1, 0), 2, 3, byrow=TRUE)
> B <- c(-1, -1)
> a <- maxNR(f, start=c(1,1.1,2), constraints=list(eqA=A, eqB=B))
> coef(a)
[1] 0.6667 0.3333 0.3333
> ## Error handling for equality constraints
> A <- matrix(c(1, 1), 1, 2)
> B <- -1
> try(a <- maxNR(f, start=c(1, 2, 3), constraints=list(eqA=A, eqB=B)))
Error in sumt(fn = fn, grad = grad, hess = hess, start = start, maxRoutine = maxNR,  : 
  Equality constraint matrix A must have the same number
of columns as the parameter length (currently 2 and 3)
>                            # ncol(A) != length(start)
> A <- matrix(c(1, 1), 1, 2)
> B <- c(-1, 2)
> try(a <- maxNR(f, start=c(1, 2), constraints=list(eqA=A, eqB=B)))
Error in sumt(fn = fn, grad = grad, hess = hess, start = start, maxRoutine = maxNR,  : 
  Equality constraint matrix A must have the same number
of rows as the matrix B (currently 1 and 2)
>                            # nrow(A) != nrow(B)
> ##                           
> ## -------------- inequality constraints ----------------
> ##
> A <- matrix(c(-1, 0,
+               0,  1), 2,2, byrow=TRUE)
> B <- c(1,1)
> start <- c(0.8, 0.9)
> ##
> a <- maxLik(logLikMix2, gradLikMix2,
+             start=start, method="bfgs",
+             constraints=list(ineqA=A, ineqB=B),
+             rho=0.5)
> print( summary( a ), digits = 2 )
--------------------------------------------
Maximum Likelihood estimation
BFGS maximisation, 38 iterations
Return code 0: successful convergence 
Log-Likelihood: -3552 
2  free parameters
Estimates:
     Estimate Std. error t value Pr(> t)    
[1,]    -1.04       0.04     -26  <2e-16 ***
[2,]     1.01       0.04      25  <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Warning: constrained likelihood estimation. Inference is probably wrong
Constrained optimization based on constrOptim 
1  outer iterations, barrier value -5.775e-05 
--------------------------------------------
> ##
> a <- maxLik(logLikMix2, 
+             start=start, method="bfgs",
+             constraints=list(ineqA=A, ineqB=B),
+             rho=0.5)
> print( summary( a ), digits = 2 )
--------------------------------------------
Maximum Likelihood estimation
BFGS maximisation, 38 iterations
Return code 0: successful convergence 
Log-Likelihood: -3552 
2  free parameters
Estimates:
     Estimate Std. error t value Pr(> t)    
[1,]    -1.04       0.04     -26  <2e-16 ***
[2,]     1.01       0.04      25  <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Warning: constrained likelihood estimation. Inference is probably wrong
Constrained optimization based on constrOptim 
1  outer iterations, barrier value -5.775e-05 
--------------------------------------------
> ##
> a <- maxLik(logLikMix2, gradLikMix2,
+             start=start, method="nm",
+             constraints=list(ineqA=A, ineqB=B),
+             rho=0.5)
> print( summary( a ), digits = 2 )
--------------------------------------------
Maximum Likelihood estimation
Nelder-Mead maximisation, 53 iterations
Return code 0: successful convergence 
Log-Likelihood: -3552 
2  free parameters
Estimates:
     Estimate Std. error t value Pr(> t)    
[1,]    -1.04       0.04     -26  <2e-16 ***
[2,]     1.01       0.04      25  <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Warning: constrained likelihood estimation. Inference is probably wrong
Constrained optimization based on constrOptim 
1  outer iterations, barrier value -5.775e-05 
--------------------------------------------
> ## ---------- test vector B for inequality  --------------
> B1 <- c(1,-2)
> a <- maxLik(logLikMix2, gradLikMix2,
+             start=c(0.5, 2.5), method="bfgs",
+             constraints=list(ineqA=A, ineqB=B1),
+             rho=0.5)
> coef(a)
[1] -0.8019  2.0000
>                            # components should be larger than
>                            # (-1, -2)
> ## ---- Now test error handling: insert wrong A and B forms ----
> A2 <- c(-1, 0, 0, 1)
> try(maxLik(logLikMix2, gradLikMix2,
+            start=start, method="bfgs",
+            constraints=list(ineqA=A2, ineqB=B),
+            print.level=1, rho=0.5)
+     )
Error in maxOptim(fn = fn, grad = grad, hess = hess, start = start, method = "BFGS",  : 
  Inequality constraint A must be a matrix
Current dimension
>                            # should explain that matrix needed
> A2 <- matrix(c(-1, 0, 0, 1), 1, 4)
> try(maxLik(logLikMix2, gradLikMix2,
+            start=start, method="bfgs",
+            constraints=list(ineqA=A2, ineqB=B),
+            print.level=1, rho=0.5)
+     )
Error in maxOptim(fn = fn, grad = grad, hess = hess, start = start, method = "BFGS",  : 
  Inequality constraint A must have the same number of columns as length of the parameter.
Currently 4 and 2.
>                            # should explain that wrong matrix
>                            # dimension
> B2 <- 1:3
> try(maxLik(logLikMix2, gradLikMix2,
+            start=start, method="bfgs",
+            constraints=list(ineqA=A, ineqB=B2),
+            print.level=1, rho=0.5)
+     )
Error in maxOptim(fn = fn, grad = grad, hess = hess, start = start, method = "BFGS",  : 
  Inequality constraints A and B suggest different number of constraints: 2 and 3
>                            # A & B do not match
> B2 <- matrix(1,2,2)
> try(maxLik(logLikMix2, gradLikMix2,
+            start=start, method="bfgs",
+            constraints=list(ineqA=A, ineqB=B2),
+            print.level=1, rho=0.5)
+     )
Error in maxOptim(fn = fn, grad = grad, hess = hess, start = start, method = "BFGS",  : 
  Inequality constraint B must be a vector (or Nx1 matrix).  Currently 2 columns
>                            # B must be a vector
> 
> ## fixed parameters with constrained optimization, BFGS.  Thanks to Bob Loos for finding this error.
> ## Optimize 3D hat with one parameter fixed (== 2D hat).
> ## Add an equality constraint on that
> hat3 <- function(param) {
+    ## Hat function.  Hessian negative definite if sqrt(x^2 + y^2) < 0.5
+    x <- param[1]
+    y <- param[2]
+    z <- param[3]
+    exp(-x^2-y^2-z^2)
+ }
> library(maxLik)
> sv <- c(1,1,1)
> ## constraints: x + y + z >= 2.5
> A <- matrix(c(1,1,1), 1, 3)
> B <- -2.5
> constraints <- list(ineqA=A, ineqB=B)
> res <- maxBFGS(hat3, start=sv, constraints=constraints, fixed=3)
> summary(res)
--------------------------------------------
BFGS maximisation 
Number of iterations: 43 
Return code: 0 
successful convergence  
Function value: 0.1194 
Estimates:
     estimate gradient
[1,]   0.7501  -0.1791
[2,]   0.7501  -0.1791
[3,]   1.0000  -0.2388

Constrained optimization based on constrOptim 
1  outer iterations, barrier value -0.0006592 
--------------------------------------------
> 
> proc.time()
   user  system elapsed 
 45.746   0.081  45.968 
